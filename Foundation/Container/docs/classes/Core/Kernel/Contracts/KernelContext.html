<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>KernelContext</title>
    <link href="../../../../../styles.css" rel="stylesheet">
</head>
<body>
<div class="layout">
                        <aside class="sidebar">
        <div class="brand"><a href="../../../../index.html">Container Docs</a></div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search...">
        </div>
        <nav>
            <div class="nav-section">
                <h3 class="nav-title">Container (Root)</h3>
                <ul class="nav-list">
                    <li><a href="../../../Container.html">Container</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Act/Inject</h3>
                <ul class="nav-list">
                    <li><a href="../../../Act/Inject/InjectDependencies.html">InjectDependencies</a></li>
                    <li><a href="../../../Act/Inject/PropertyInjector.html">PropertyInjector</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Advanced/Lazy</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Advanced/Lazy/LazyInterface.html">LazyInterface</a></li>
                    <li><a href="../../../Actions/Advanced/Lazy/LazyValue.html">LazyValue</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Inject</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Inject/InjectDependencies.html">InjectDependencies</a></li>
                    <li><a href="../../../Actions/Inject/PropertyInjector.html">PropertyInjector</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Inject/Resolvers</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Inject/Resolvers/PropertyResolution.html">PropertyResolution</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Instantiate</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Instantiate/Instantiator.html">Instantiator</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Invoke/Cache</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Invoke/Cache/ReflectionCache.html">ReflectionCache</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Advanced/Lazy</h3>
                <ul class="nav-list">
                    <li><a href="../../../Advanced/Lazy/LazyInterface.html">LazyInterface</a></li>
                    <li><a href="../../../Advanced/Lazy/LazyValue.html">LazyValue</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Advanced/Observe</h3>
                <ul class="nav-list">
                    <li><a href="../../../Advanced/Observe/DiagnosticsFlow.html">DiagnosticsFlow</a></li>
                    <li><a href="../../../Advanced/Observe/Telemetry.html">Telemetry</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Advanced/Policy</h3>
                <ul class="nav-list">
                    <li><a href="../../../Advanced/Policy/PolicyFlow.html">PolicyFlow</a></li>
                    <li><a href="../../../Advanced/Policy/Security.html">Security</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core</h3>
                <ul class="nav-list">
                    <li><a href="../../Container.html">Container</a></li>
                    <li><a href="../../ContainerBuilder.html">ContainerBuilder</a></li>
                    <li><a href="../../ContainerConfig.html">ContainerConfig</a></li>
                    <li><a href="../../ContainerEngine.html">ContainerEngine</a></li>
                    <li><a href="../../ContainerKernel.html">ContainerKernel</a></li>
                    <li><a href="../../ResolutionEngine.html">ResolutionEngine</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Attribute</h3>
                <ul class="nav-list">
                    <li><a href="../../Attribute/Inject.html">Inject</a></li>
                    <li><a href="../../Attribute/Singleton.html">Singleton</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/DTO</h3>
                <ul class="nav-list">
                    <li><a href="../../DTO/ErrorDTO.html">ErrorDTO</a></li>
                    <li><a href="../../DTO/InjectionReport.html">InjectionReport</a></li>
                    <li><a href="../../DTO/SuccessDTO.html">SuccessDTO</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Enum</h3>
                <ul class="nav-list">
                    <li><a href="../../Enum/ServiceLifetime.html">ServiceLifetime</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Exceptions</h3>
                <ul class="nav-list">
                    <li><a href="../../Exceptions/ContainerExceptions.html">ContainerExceptions</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel</h3>
                <ul class="nav-list">
                    <li><a href="../KernelCompiler.html">KernelCompiler</a></li>
                    <li><a href="../KernelConfig.html">KernelConfig</a></li>
                    <li><a href="../KernelFacade.html">KernelFacade</a></li>
                    <li><a href="../KernelRuntime.html">KernelRuntime</a></li>
                    <li><a href="../KernelState.html">KernelState</a></li>
                    <li><a href="../LifecycleResolver.html">LifecycleResolver</a></li>
                    <li><a href="../LifecycleStrategyRegistry.html">LifecycleStrategyRegistry</a></li>
                    <li><a href="../ResolutionPipeline.html">ResolutionPipeline</a></li>
                    <li><a href="../ResolutionPipelineBuilder.html">ResolutionPipelineBuilder</a></li>
                    <li><a href="../StepTelemetryCollector.html">StepTelemetryCollector</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Contracts</h3>
                <ul class="nav-list">
                    <li><a href="KernelContext.html">KernelContext</a></li>
                    <li><a href="KernelStep.html">KernelStep</a></li>
                    <li><a href="LifecycleStrategy.html">LifecycleStrategy</a></li>
                    <li><a href="StepTelemetry.html">StepTelemetry</a></li>
                    <li><a href="TerminalKernelStep.html">TerminalKernelStep</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Events</h3>
                <ul class="nav-list">
                    <li><a href="../Events/StepFailed.html">StepFailed</a></li>
                    <li><a href="../Events/StepStarted.html">StepStarted</a></li>
                    <li><a href="../Events/StepSucceeded.html">StepSucceeded</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Steps</h3>
                <ul class="nav-list">
                    <li><a href="../Steps/AnalyzePrototypeStep.html">AnalyzePrototypeStep</a></li>
                    <li><a href="../Steps/ApplyExtendersStep.html">ApplyExtendersStep</a></li>
                    <li><a href="../Steps/CircularDependencyStep.html">CircularDependencyStep</a></li>
                    <li><a href="../Steps/CollectDiagnosticsStep.html">CollectDiagnosticsStep</a></li>
                    <li><a href="../Steps/DepthGuardStep.html">DepthGuardStep</a></li>
                    <li><a href="../Steps/EnsureDefinitionExistsStep.html">EnsureDefinitionExistsStep</a></li>
                    <li><a href="../Steps/GuardPolicyStep.html">GuardPolicyStep</a></li>
                    <li><a href="../Steps/InjectDependenciesStep.html">InjectDependenciesStep</a></li>
                    <li><a href="../Steps/InvokePostConstructStep.html">InvokePostConstructStep</a></li>
                    <li><a href="../Steps/ResolveInstanceStep.html">ResolveInstanceStep</a></li>
                    <li><a href="../Steps/RetrieveFromScopeStep.html">RetrieveFromScopeStep</a></li>
                    <li><a href="../Steps/StoreLifecycleStep.html">StoreLifecycleStep</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Strategies</h3>
                <ul class="nav-list">
                    <li><a href="../Strategies/ScopedLifecycleStrategy.html">ScopedLifecycleStrategy</a></li>
                    <li><a href="../Strategies/SingletonLifecycleStrategy.html">SingletonLifecycleStrategy</a></li>
                    <li><a href="../Strategies/TransientLifecycleStrategy.html">TransientLifecycleStrategy</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Utils</h3>
                <ul class="nav-list">
                    <li><a href="../../Utils/ArrayTools.html">ArrayTools</a></li>
                    <li><a href="../../Utils/StrTools.html">StrTools</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Define/Bind</h3>
                <ul class="nav-list">
                    <li><a href="../../../Define/Bind/BindingBuilder.html">BindingBuilder</a></li>
                    <li><a href="../../../Define/Bind/ContextBuilder.html">ContextBuilder</a></li>
                    <li><a href="../../../Define/Bind/Registrar.html">Registrar</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Define/Store</h3>
                <ul class="nav-list">
                    <li><a href="../../../Define/Store/DefinitionStore.html">DefinitionStore</a></li>
                    <li><a href="../../../Define/Store/ServiceDefinition.html">ServiceDefinition</a></li>
                    <li><a href="../../../Define/Store/ServiceDefinitionEntity.html">ServiceDefinitionEntity</a></li>
                    <li><a href="../../../Define/Store/ServiceDiscovery.html">ServiceDiscovery</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Define/Store/Compiler</h3>
                <ul class="nav-list">
                    <li><a href="../../../Define/Store/Compiler/CompilerPassInterface.html">CompilerPassInterface</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Invoke</h3>
                <ul class="nav-list">
                    <li><a href="../../../Invoke/InvocationExecutor.html">InvocationExecutor</a></li>
                    <li><a href="../../../Invoke/InvokeAction.html">InvokeAction</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Invoke/Cache</h3>
                <ul class="nav-list">
                    <li><a href="../../../Invoke/Cache/ReflectionCache.html">ReflectionCache</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Invoke/Context</h3>
                <ul class="nav-list">
                    <li><a href="../../../Invoke/Context/InvocationContext.html">InvocationContext</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/ScopeManager.html">ScopeManager</a></li>
                    <li><a href="../../../Operate/ScopeRegistry.html">ScopeRegistry</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Boot</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Boot/Application.html">Application</a></li>
                    <li><a href="../../../Operate/Boot/ApplicationBuilder.html">ApplicationBuilder</a></li>
                    <li><a href="../../../Operate/Boot/ContainerBootstrapper.html">ContainerBootstrapper</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Config</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Config/BootstrapProfile.html">BootstrapProfile</a></li>
                    <li><a href="../../../Operate/Config/ContainerConfig.html">ContainerConfig</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Scope</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Scope/ScopeManager.html">ScopeManager</a></li>
                    <li><a href="../../../Operate/Scope/ScopeRegistry.html">ScopeRegistry</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Shutdown</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Shutdown/TerminateContainer.html">TerminateContainer</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Resolve</h3>
                <ul class="nav-list">
                    <li><a href="../../../Resolve/DependencyResolver.html">DependencyResolver</a></li>
                    <li><a href="../../../Resolve/ResolutionContext.html">ResolutionContext</a></li>
                    <li><a href="../../../Resolve/ResolutionEngine.html">ResolutionEngine</a></li>
                    <li><a href="../../../Resolve/ResolutionPipeline.html">ResolutionPipeline</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Resolve/Pipes</h3>
                <ul class="nav-list">
                    <li><a href="../../../Resolve/Pipes/AutowirePipe.html">AutowirePipe</a></li>
                    <li><a href="../../../Resolve/Pipes/BindingPipe.html">BindingPipe</a></li>
                    <li><a href="../../../Resolve/Pipes/ScopePipe.html">ScopePipe</a></li>
                    <li><a href="../../../Resolve/Pipes/TerminalPipe.html">TerminalPipe</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Resolve/Resolvers</h3>
                <ul class="nav-list">
                    <li><a href="../../../Resolve/Resolvers/DefaultResolver.html">DefaultResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/ExceptionResolver.html">ExceptionResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/NullResolver.html">NullResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/OverrideResolver.html">OverrideResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/ParameterResolutionChain.html">ParameterResolutionChain</a></li>
                    <li><a href="../../../Resolve/Resolvers/ParameterResolver.html">ParameterResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/TypeResolver.html">TypeResolver</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Analyze</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Analyze/PrototypeAnalyzer.html">PrototypeAnalyzer</a></li>
                    <li><a href="../../../Think/Analyze/ReflectionTypeAnalyzer.html">ReflectionTypeAnalyzer</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Cache</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Cache/FilePrototypeCache.html">FilePrototypeCache</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Model</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Model/MethodPrototype.html">MethodPrototype</a></li>
                    <li><a href="../../../Think/Model/ParameterPrototype.html">ParameterPrototype</a></li>
                    <li><a href="../../../Think/Model/PropertyPrototype.html">PropertyPrototype</a></li>
                    <li><a href="../../../Think/Model/ServicePrototype.html">ServicePrototype</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Prototype</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Prototype/ServicePrototypeFactory.html">ServicePrototypeFactory</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Prototype/Contracts</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Prototype/Contracts/ServicePrototypeFactoryInterface.html">ServicePrototypeFactoryInterface</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Verify</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Verify/VerifyPrototype.html">VerifyPrototype</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Guidelines</h3>
                <ul class="nav-list">
                    <li><a href="../../../../master-prompt.html">Master Prompt</a></li>
                </ul>
            </div>
        </nav>
    </aside>
    <main class="content">
        <section class="hero">
            <h1>KernelContext</h1>
            <p>Mutable Service Resolution State</p>
            <div class="meta">Foundation/Container/Core/Kernel/Contracts/KernelContext.php</div>
        </section>

        <section class="section">
            <h2>Class Overview</h2>
            <div class="card">
                <p>KernelContext is the mutable state object that flows through the resolution pipeline. It carries all information about a service resolution operation, from the initial request through to the final resolved instance. This context enables pipeline steps to communicate and collaborate on the resolution process.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To provide a consistent data structure for resolution operations</p>
                    <p>- To enable pipeline steps to share state and metadata</p>
                    <p>- To track resolution depth and detect circular dependencies</p>
                    <p>- To carry configuration flags and overrides through the pipeline</p>
                    <p><strong>HOW IT FITS IN THE PIPELINE:</strong></p>
                    <p>The context is created at the start of resolution and passed through each pipeline step:</p>
                    <p><code>Runtime</code> → <code>Pipeline</code> → <code>Steps</code> → <code>Context</code> → <code>Instance</code></p>
                    <p>Each step can read from and write to the context, accumulating information as resolution progresses.</p>
                    <p><strong>MUTABLE STATE:</strong></p>
                    <p>Unlike most container objects, the context is mutable to allow pipeline steps to modify resolution state. This is controlled through specific methods to maintain consistency.</p>
                </details>
            </div>
        </section>

        <section class="section">
            <h2>Resolution Flow Example</h2>
            <div class="card">
                <pre><code class="language-php">// Context flows through the resolution pipeline
$context = new KernelContext(serviceId: 'UserService');

// Pipeline steps modify the context
$bindingStep->run($context);     // Adds binding metadata
$scopeStep->run($context);       // Checks for cached instances
$injectStep->run($context);      // Resolves dependencies

// Final context contains resolved instance
$userService = $context->getInstance();

// Context also tracks resolution path
echo $context->getPath(); // "UserService -> UserRepository -> Database"</code></pre>
                <details class="more">
                    <summary>More</summary>
                    <p>The context serves as a blackboard where pipeline steps can write information and read decisions made by previous steps. This enables complex resolution logic while keeping each step focused on a single concern.</p>
                </details>
            </div>
        </section>

        <section class="section">
            <h2>Circular Dependency Detection</h2>
            <div class="card">
                <pre><code class="language-php">// Context hierarchy prevents circular dependencies
class A {
    public function __construct(B $b) {}
}

class B {
    public function __construct(A $a) {} // Circular!
}

// Resolution of A creates context
$contextA = new KernelContext(serviceId: 'A');

// When resolving B (dependency of A)
$contextB = $contextA->child('B');

// B tries to resolve A, creates child context
$contextA2 = $contextB->child('A');

// Check for circular dependency
if ($contextA2->contains('A')) {
    throw new CircularDependencyException('A -> B -> A');
}</code></pre>
                <details class="more">
                    <summary>More</summary>
                    <p>The context maintains a parent-child hierarchy that tracks the resolution path. The contains() method can detect when a service appears twice in the path, indicating a circular dependency.</p>
                </details>
            </div>
        </section>

        <section class="section">
            <h2>Metadata System</h2>
            <div class="card">
                <pre><code class="language-php">// Pipeline steps use metadata to communicate
$context = new KernelContext(serviceId: 'UserService');

// Binding step stores resolved binding
$context->setMeta('binding', 'concrete', 'SqlUserRepository');
$context->setMeta('binding', 'lifetime', 'singleton');

// Injection step reads binding info
$concrete = $context->getMeta('binding', 'concrete');

// Prototype step caches analysis
$context->setMeta('analysis', 'prototype', $prototype);

// Later steps can read the prototype
$cachedPrototype = $context->getMeta('analysis', 'prototype');</code></pre>
                <details class="more">
                    <summary>More</summary>
                    <p>The metadata system uses namespaced keys to prevent conflicts between pipeline steps. Common namespaces include 'binding', 'analysis', 'inject', and 'scope'.</p>
                </details>
            </div>
        </section>

        <section class="section">
            <h2>Methods</h2>

            <div class="card" id="__construct">
                <h3>__construct</h3>
                <p>Create a new resolution context.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To initialize the context with all necessary resolution parameters</p>
                    <p>- To establish the baseline state for the resolution operation</p>
                    <p>- To configure resolution behavior through various flags</p>
                    <p><strong>KEY PARAMETERS:</strong></p>
                    <p><em>serviceId</em>: The identifier of the service being resolved (required)</p>
                    <p><em>debug</em>: Enables debug mode with additional logging</p>
                    <p><em>allowAutowire</em>: Controls whether autowiring is permitted</p>
                    <p><em>manualInjection</em>: Indicates injection-only operations</p>
                    <p><em>depth</em>: Tracks recursion depth for circular dependency detection</p>
                    <p><em>overrides</em>: Parameter values that override automatic resolution</p>
                    <p><strong>IMMUTABLE PROPERTIES:</strong></p>
                    <p>Most properties are readonly to ensure consistent resolution behavior. Only the instance and metadata can be modified during resolution.</p>
                </details>
            </div>

            <div class="card" id="child">
                <h3>child</h3>
                <p>Create a child context for recursive resolution.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To create nested contexts for dependency resolution</p>
                    <p>- To maintain the resolution path for debugging and error messages</p>
                    <p>- To track recursion depth for circular dependency detection</p>
                    <p><strong>CONTEXT HIERARCHY:</strong></p>
                    <p>Creates a parent-child relationship:</p>
                    <p><code>Parent Context (UserService)</code></p>
                    <p><code>  └─ Child Context (UserRepository)</code></p>
                    <p><code>      └─ Child Context (Database)</code></p>
                    <p><strong>INHERITED PROPERTIES:</strong></p>
                    <p>Child contexts inherit debug settings, autowire permissions, and trace IDs from their parent, but get their own serviceId and incremented depth.</p>
                    <p><strong>CONSUMER TRACKING:</strong></p>
                    <p>The parent's serviceId becomes the child's consumer, establishing the dependency relationship for error reporting and contextual bindings.</p>
                </details>
            </div>

            <div class="card" id="getInstance">
                <h3>getInstance</h3>
                <p>Get the resolved instance.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To provide access to the final resolved service instance</p>
                    <p>- To allow pipeline steps to check resolution status</p>
                    <p>- To return the result of the resolution operation</p>
                    <p><strong>NULL RETURN:</strong></p>
                    <p>Returns null if resolution hasn't completed yet. Pipeline steps use isResolved() to check completion status before calling getInstance().</p>
                    <p><strong>TYPE VARIANCE:</strong></p>
                    <p>The return type is mixed because contexts can resolve any type of service - objects, scalars, callables, etc.</p>
                </details>
            </div>

            <div class="card" id="contains">
                <h3>contains</h3>
                <p>Check if a service exists in the current resolution path.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To detect circular dependencies during resolution</p>
                    <p>- To prevent infinite recursion in dependency graphs</p>
                    <p>- To provide early failure for invalid service configurations</p>
                    <p><strong>CIRCULAR DETECTION:</strong></p>
                    <p>Walks up the context hierarchy checking each serviceId:</p>
                    <p><code>A -> B -> C -> A (circular!)</code></p>
                    <p>When C tries to resolve A again, contains('A') returns true, triggering a CircularDependencyException.</p>
                    <p><strong>PERFORMANCE:</strong></p>
                    <p>O(depth) operation, but depth is typically small (3-5 levels) in well-designed applications. Pathological cases with very deep dependency trees will have performance implications.</p>
                </details>
            </div>

            <div class="card" id="getPath">
                <h3>getPath</h3>
                <p>Get the resolution path as a string.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To provide human-readable resolution paths for debugging</p>
                    <p>- To generate meaningful error messages</p>
                    <p>- To support logging and monitoring of resolution operations</p>
                    <p><strong>PATH FORMAT:</strong></p>
                    <p>Creates a chain showing dependency relationships:</p>
                    <p><code>"UserService -> UserRepository -> Database"</code></p>
                    <p>This helps developers understand why certain services are being resolved and identify unexpected dependencies.</p>
                    <p><strong>RECURSIVE CONSTRUCTION:</strong></p>
                    <p>Each context asks its parent for their path segment, building the complete chain from the root to the current context.</p>
                </details>
            </div>

            <div class="card" id="setMetaOnce">
                <h3>setMetaOnce</h3>
                <p>Set metadata only if not already set.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To allow conditional metadata setting</p>
                    <p>- To prevent overwriting important metadata by later pipeline steps</p>
                    <p>- To support first-writer-wins semantics for certain metadata</p>
                    <p><strong>USE CASES:</strong></p>
                    <p>- Setting binding information (only the first binding step should set this)</p>
                    <p>- Recording initial resolution time</p>
                    <p>- Storing the first error encountered</p>
                </details>
            </div>

            <div class="card" id="setMeta">
                <h3>setMeta</h3>
                <p>Set metadata value.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To store information generated during resolution</p>
                    <p>- To enable communication between pipeline steps</p>
                    <p>- To cache analysis results and intermediate data</p>
                    <p><strong>NAMESPACE DESIGN:</strong></p>
                    <p>Uses namespaced keys to prevent conflicts:</p>
                    <p><code>$context->setMeta('binding', 'concrete', 'MyClass')</code></p>
                    <p><code>$context->setMeta('analysis', 'prototype', $prototype)</code></p>
                    <p>Common namespaces: 'binding', 'analysis', 'inject', 'scope', 'cache'</p>
                </details>
            </div>

            <div class="card" id="putMeta">
                <h3>putMeta</h3>
                <p>Store metadata value.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To provide the core metadata storage mechanism</p>
                    <p>- To ensure consistent metadata structure</p>
                    <p>- To support the namespaced key-value storage</p>
                    <p><strong>STORAGE STRUCTURE:</strong></p>
                    <p>Metadata is stored as nested arrays:</p>
                    <p><code>$metadata['namespace']['key'] = value</code></p>
                    <p>This allows multiple pipeline steps to use the same namespace without conflicts.</p>
                </details>
            </div>

            <div class="card" id="getMeta">
                <h3>getMeta</h3>
                <p>Get metadata value with default.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To retrieve metadata set by previous pipeline steps</p>
                    <p>- To support conditional logic based on resolution state</p>
                    <p>- To provide safe access with default values</p>
                    <p><strong>DEFAULT HANDLING:</strong></p>
                    <p>Uses null coalescing for clean default handling:</p>
                    <p><code>return $this->metadata[$namespace][$key] ?? $default</code></p>
                    <p>This works correctly even when the namespace or key doesn't exist.</p>
                </details>
            </div>

            <div class="card" id="hasMeta">
                <h3>hasMeta</h3>
                <p>Check if metadata exists.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To check for the presence of metadata without retrieving it</p>
                    <p>- To support conditional pipeline step execution</p>
                    <p>- To avoid default value coercion issues</p>
                    <p><strong>DIFFERENCE FROM getMeta:</strong></p>
                    <p>- hasMeta(): Checks existence (including null values)</p>
                    <p>- getMeta(): Returns value or default (doesn't distinguish null from missing)</p>
                </details>
            </div>

            <div class="card" id="setInstanceSafe">
                <h3>setInstanceSafe</h3>
                <p>Safely set the instance if not already resolved.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To allow conditional instance setting</p>
                    <p>- To prevent accidental overwrites by pipeline steps</p>
                    <p>- To support multi-step resolution processes</p>
                    <p><strong>SAFE GUARD:</strong></p>
                    <p>Only sets the instance if it's currently null:</p>
                    <p><code>if ($this->instance === null) { $this->instance = $instance; }</code></p>
                    <p>This ensures the first successful resolution step "wins" and subsequent steps don't overwrite it.</p>
                </details>
            </div>

            <div class="card" id="overwriteWith">
                <h3>overwriteWith</h3>
                <p>Explicitly overwrite the instance.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To support extenders and decorators that modify instances</p>
                    <p>- To allow intentional instance replacement</p>
                    <p>- To enable post-resolution transformations</p>
                    <p><strong>USE CASES:</strong></p>
                    <p>- Service decorators that wrap the original instance</p>
                    <p>- Proxy objects that intercept method calls</p>
                    <p>- Caching layers that return cached results</p>
                    <p><strong>UNCONDITIONAL:</strong></p>
                    <p>Always overwrites, regardless of current state. Use resolvedWith() for initial resolution to get safety checks.</p>
                </details>
            </div>

            <div class="card" id="setInstance">
                <h3>setInstance</h3>
                <p>Set the resolved instance.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To provide a convenient alias for resolvedWith()</p>
                    <p>- To match common naming expectations</p>
                    <p>- To maintain API consistency</p>
                    <p><strong>DELEGATION:</strong></p>
                    <p>Simply calls resolvedWith() with the same validation logic.</p>
                </details>
            </div>

            <div class="card" id="resolvedWith">
                <h3>resolvedWith</h3>
                <p>Safely set the resolved instance.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To set the initial resolved instance with safety checks</p>
                    <p>- To prevent multiple resolution attempts from conflicting</p>
                    <p>- To provide clear error messages for resolution conflicts</p>
                    <p><strong>VALIDATION:</strong></p>
                    <p>Throws LogicException if instance is already set:</p>
                    <p><code>"Instance already resolved for [{$this->serviceId}]"</code></p>
                    <p>This prevents pipeline steps from accidentally overwriting each other's work.</p>
                    <p><strong>WHEN TO USE:</strong></p>
                    <p>Use for initial resolution. Use overwriteWith() when you intentionally want to replace an existing instance (decorators, proxies, etc.).</p>
                </details>
            </div>

            <div class="card" id="__toString">
                <h3>__toString</h3>
                <p>String representation of the context.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To provide human-readable context information for debugging</p>
                    <p>- To support logging and error messages</p>
                    <p>- To enable easy inspection in development tools</p>
                    <p><strong>FORMAT:</strong></p>
                    <p><code>KernelContext{serviceId=UserService, depth=2, resolved=yes}</code></p>
                    <p>Includes the key information: what service, how deep in the resolution tree, and whether it's resolved.</p>
                </details>
            </div>

            <div class="card" id="isResolved">
                <h3>isResolved</h3>
                <p>Check if the context has a resolved instance.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To check resolution completion status</p>
                    <p>- To enable conditional logic in pipeline steps</p>
                    <p>- To determine if further resolution is needed</p>
                    <p><strong>SIMPLE CHECK:</strong></p>
                    <p><code>return $this->instance !== null</code></p>
                    <p>A resolved context has a non-null instance. Pipeline steps can use this to decide whether to proceed with resolution or return early.</p>
                </details>
            </div>
        </section>
    </main>
</div>
</body>
</html>