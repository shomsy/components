<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <title>StepTelemetry</title>
    <link href="../../../../../styles.css" rel="stylesheet">
</head>
<body>
<div class="layout">
                        <aside class="sidebar">
        <div class="brand"><a href="../../../../index.html">Container Docs</a></div>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="Search...">
        </div>
        <nav>
            <div class="nav-section">
                <h3 class="nav-title">Container (Root)</h3>
                <ul class="nav-list">
                    <li><a href="../../../Container.html">Container</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Act/Inject</h3>
                <ul class="nav-list">
                    <li><a href="../../../Act/Inject/InjectDependencies.html">InjectDependencies</a></li>
                    <li><a href="../../../Act/Inject/PropertyInjector.html">PropertyInjector</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Advanced/Lazy</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Advanced/Lazy/LazyInterface.html">LazyInterface</a></li>
                    <li><a href="../../../Actions/Advanced/Lazy/LazyValue.html">LazyValue</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Inject</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Inject/InjectDependencies.html">InjectDependencies</a></li>
                    <li><a href="../../../Actions/Inject/PropertyInjector.html">PropertyInjector</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Inject/Resolvers</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Inject/Resolvers/PropertyResolution.html">PropertyResolution</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Instantiate</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Instantiate/Instantiator.html">Instantiator</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Actions/Invoke/Cache</h3>
                <ul class="nav-list">
                    <li><a href="../../../Actions/Invoke/Cache/ReflectionCache.html">ReflectionCache</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Advanced/Lazy</h3>
                <ul class="nav-list">
                    <li><a href="../../../Advanced/Lazy/LazyInterface.html">LazyInterface</a></li>
                    <li><a href="../../../Advanced/Lazy/LazyValue.html">LazyValue</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Advanced/Observe</h3>
                <ul class="nav-list">
                    <li><a href="../../../Advanced/Observe/DiagnosticsFlow.html">DiagnosticsFlow</a></li>
                    <li><a href="../../../Advanced/Observe/Telemetry.html">Telemetry</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Advanced/Policy</h3>
                <ul class="nav-list">
                    <li><a href="../../../Advanced/Policy/PolicyFlow.html">PolicyFlow</a></li>
                    <li><a href="../../../Advanced/Policy/Security.html">Security</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core</h3>
                <ul class="nav-list">
                    <li><a href="../../Container.html">Container</a></li>
                    <li><a href="../../ContainerBuilder.html">ContainerBuilder</a></li>
                    <li><a href="../../ContainerConfig.html">ContainerConfig</a></li>
                    <li><a href="../../ContainerEngine.html">ContainerEngine</a></li>
                    <li><a href="../../ContainerKernel.html">ContainerKernel</a></li>
                    <li><a href="../../ResolutionEngine.html">ResolutionEngine</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Attribute</h3>
                <ul class="nav-list">
                    <li><a href="../../Attribute/Inject.html">Inject</a></li>
                    <li><a href="../../Attribute/Singleton.html">Singleton</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/DTO</h3>
                <ul class="nav-list">
                    <li><a href="../../DTO/ErrorDTO.html">ErrorDTO</a></li>
                    <li><a href="../../DTO/InjectionReport.html">InjectionReport</a></li>
                    <li><a href="../../DTO/SuccessDTO.html">SuccessDTO</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Enum</h3>
                <ul class="nav-list">
                    <li><a href="../../Enum/ServiceLifetime.html">ServiceLifetime</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Exceptions</h3>
                <ul class="nav-list">
                    <li><a href="../../Exceptions/ContainerExceptions.html">ContainerExceptions</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel</h3>
                <ul class="nav-list">
                    <li><a href="../KernelCompiler.html">KernelCompiler</a></li>
                    <li><a href="../KernelConfig.html">KernelConfig</a></li>
                    <li><a href="../KernelFacade.html">KernelFacade</a></li>
                    <li><a href="../KernelRuntime.html">KernelRuntime</a></li>
                    <li><a href="../KernelState.html">KernelState</a></li>
                    <li><a href="../LifecycleResolver.html">LifecycleResolver</a></li>
                    <li><a href="../LifecycleStrategyRegistry.html">LifecycleStrategyRegistry</a></li>
                    <li><a href="../ResolutionPipeline.html">ResolutionPipeline</a></li>
                    <li><a href="../ResolutionPipelineBuilder.html">ResolutionPipelineBuilder</a></li>
                    <li><a href="../StepTelemetryCollector.html">StepTelemetryCollector</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Contracts</h3>
                <ul class="nav-list">
                    <li><a href="KernelContext.html">KernelContext</a></li>
                    <li><a href="KernelStep.html">KernelStep</a></li>
                    <li><a href="LifecycleStrategy.html">LifecycleStrategy</a></li>
                    <li><a href="StepTelemetry.html">StepTelemetry</a></li>
                    <li><a href="TerminalKernelStep.html">TerminalKernelStep</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Events</h3>
                <ul class="nav-list">
                    <li><a href="../Events/StepFailed.html">StepFailed</a></li>
                    <li><a href="../Events/StepStarted.html">StepStarted</a></li>
                    <li><a href="../Events/StepSucceeded.html">StepSucceeded</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Steps</h3>
                <ul class="nav-list">
                    <li><a href="../Steps/AnalyzePrototypeStep.html">AnalyzePrototypeStep</a></li>
                    <li><a href="../Steps/ApplyExtendersStep.html">ApplyExtendersStep</a></li>
                    <li><a href="../Steps/CircularDependencyStep.html">CircularDependencyStep</a></li>
                    <li><a href="../Steps/CollectDiagnosticsStep.html">CollectDiagnosticsStep</a></li>
                    <li><a href="../Steps/DepthGuardStep.html">DepthGuardStep</a></li>
                    <li><a href="../Steps/EnsureDefinitionExistsStep.html">EnsureDefinitionExistsStep</a></li>
                    <li><a href="../Steps/GuardPolicyStep.html">GuardPolicyStep</a></li>
                    <li><a href="../Steps/InjectDependenciesStep.html">InjectDependenciesStep</a></li>
                    <li><a href="../Steps/InvokePostConstructStep.html">InvokePostConstructStep</a></li>
                    <li><a href="../Steps/ResolveInstanceStep.html">ResolveInstanceStep</a></li>
                    <li><a href="../Steps/RetrieveFromScopeStep.html">RetrieveFromScopeStep</a></li>
                    <li><a href="../Steps/StoreLifecycleStep.html">StoreLifecycleStep</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Kernel/Strategies</h3>
                <ul class="nav-list">
                    <li><a href="../Strategies/ScopedLifecycleStrategy.html">ScopedLifecycleStrategy</a></li>
                    <li><a href="../Strategies/SingletonLifecycleStrategy.html">SingletonLifecycleStrategy</a></li>
                    <li><a href="../Strategies/TransientLifecycleStrategy.html">TransientLifecycleStrategy</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Core/Utils</h3>
                <ul class="nav-list">
                    <li><a href="../../Utils/ArrayTools.html">ArrayTools</a></li>
                    <li><a href="../../Utils/StrTools.html">StrTools</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Define/Bind</h3>
                <ul class="nav-list">
                    <li><a href="../../../Define/Bind/BindingBuilder.html">BindingBuilder</a></li>
                    <li><a href="../../../Define/Bind/ContextBuilder.html">ContextBuilder</a></li>
                    <li><a href="../../../Define/Bind/Registrar.html">Registrar</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Define/Store</h3>
                <ul class="nav-list">
                    <li><a href="../../../Define/Store/DefinitionStore.html">DefinitionStore</a></li>
                    <li><a href="../../../Define/Store/ServiceDefinition.html">ServiceDefinition</a></li>
                    <li><a href="../../../Define/Store/ServiceDefinitionEntity.html">ServiceDefinitionEntity</a></li>
                    <li><a href="../../../Define/Store/ServiceDiscovery.html">ServiceDiscovery</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Define/Store/Compiler</h3>
                <ul class="nav-list">
                    <li><a href="../../../Define/Store/Compiler/CompilerPassInterface.html">CompilerPassInterface</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Invoke</h3>
                <ul class="nav-list">
                    <li><a href="../../../Invoke/InvocationExecutor.html">InvocationExecutor</a></li>
                    <li><a href="../../../Invoke/InvokeAction.html">InvokeAction</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Invoke/Cache</h3>
                <ul class="nav-list">
                    <li><a href="../../../Invoke/Cache/ReflectionCache.html">ReflectionCache</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Invoke/Context</h3>
                <ul class="nav-list">
                    <li><a href="../../../Invoke/Context/InvocationContext.html">InvocationContext</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/ScopeManager.html">ScopeManager</a></li>
                    <li><a href="../../../Operate/ScopeRegistry.html">ScopeRegistry</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Boot</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Boot/Application.html">Application</a></li>
                    <li><a href="../../../Operate/Boot/ApplicationBuilder.html">ApplicationBuilder</a></li>
                    <li><a href="../../../Operate/Boot/ContainerBootstrapper.html">ContainerBootstrapper</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Config</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Config/BootstrapProfile.html">BootstrapProfile</a></li>
                    <li><a href="../../../Operate/Config/ContainerConfig.html">ContainerConfig</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Scope</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Scope/ScopeManager.html">ScopeManager</a></li>
                    <li><a href="../../../Operate/Scope/ScopeRegistry.html">ScopeRegistry</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Operate/Shutdown</h3>
                <ul class="nav-list">
                    <li><a href="../../../Operate/Shutdown/TerminateContainer.html">TerminateContainer</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Resolve</h3>
                <ul class="nav-list">
                    <li><a href="../../../Resolve/DependencyResolver.html">DependencyResolver</a></li>
                    <li><a href="../../../Resolve/ResolutionContext.html">ResolutionContext</a></li>
                    <li><a href="../../../Resolve/ResolutionEngine.html">ResolutionEngine</a></li>
                    <li><a href="../../../Resolve/ResolutionPipeline.html">ResolutionPipeline</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Resolve/Pipes</h3>
                <ul class="nav-list">
                    <li><a href="../../../Resolve/Pipes/AutowirePipe.html">AutowirePipe</a></li>
                    <li><a href="../../../Resolve/Pipes/BindingPipe.html">BindingPipe</a></li>
                    <li><a href="../../../Resolve/Pipes/ScopePipe.html">ScopePipe</a></li>
                    <li><a href="../../../Resolve/Pipes/TerminalPipe.html">TerminalPipe</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Resolve/Resolvers</h3>
                <ul class="nav-list">
                    <li><a href="../../../Resolve/Resolvers/DefaultResolver.html">DefaultResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/ExceptionResolver.html">ExceptionResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/NullResolver.html">NullResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/OverrideResolver.html">OverrideResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/ParameterResolutionChain.html">ParameterResolutionChain</a></li>
                    <li><a href="../../../Resolve/Resolvers/ParameterResolver.html">ParameterResolver</a></li>
                    <li><a href="../../../Resolve/Resolvers/TypeResolver.html">TypeResolver</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Analyze</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Analyze/PrototypeAnalyzer.html">PrototypeAnalyzer</a></li>
                    <li><a href="../../../Think/Analyze/ReflectionTypeAnalyzer.html">ReflectionTypeAnalyzer</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Cache</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Cache/FilePrototypeCache.html">FilePrototypeCache</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Model</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Model/MethodPrototype.html">MethodPrototype</a></li>
                    <li><a href="../../../Think/Model/ParameterPrototype.html">ParameterPrototype</a></li>
                    <li><a href="../../../Think/Model/PropertyPrototype.html">PropertyPrototype</a></li>
                    <li><a href="../../../Think/Model/ServicePrototype.html">ServicePrototype</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Prototype</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Prototype/ServicePrototypeFactory.html">ServicePrototypeFactory</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Prototype/Contracts</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Prototype/Contracts/ServicePrototypeFactoryInterface.html">ServicePrototypeFactoryInterface</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Think/Verify</h3>
                <ul class="nav-list">
                    <li><a href="../../../Think/Verify/VerifyPrototype.html">VerifyPrototype</a></li>
                </ul>
            </div>
            <div class="nav-section">
                <h3 class="nav-title">Guidelines</h3>
                <ul class="nav-list">
                    <li><a href="../../../../master-prompt.html">Master Prompt</a></li>
                </ul>
            </div>
        </nav>
    </aside>
    <main class="content">
        <section class="hero">
            <h1>StepTelemetry</h1>
            <p>Observer pattern for pipeline step events</p>
            <div class="meta">Foundation/Container/Core/Kernel/Contracts/StepTelemetry.php</div>
        </section>

        <section class="section">
            <h2>Interface Overview</h2>
            <div class="card">
                <p>StepTelemetry defines the observer pattern for collecting telemetry data from pipeline step execution. It receives events when steps start, succeed, or fail, enabling comprehensive observability of the resolution process.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To enable observability of container resolution pipeline</p>
                    <p>- To collect metrics, logs, and traces from step execution</p>
                    <p>- To support debugging and performance monitoring</p>
                    <p>- To provide pluggable telemetry implementations</p>
                    <p><strong>HOW IT FITS IN THE PIPELINE:</strong></p>
                    <p>The pipeline notifies telemetry observers at key points:</p>
                    <p><code>Pipeline</code> → <code>Step</code> → <code>Telemetry.onStepStarted()</code></p>
                    <p><code>Pipeline</code> → <code>Step</code> → <code>Telemetry.onStepSucceeded()</code></p>
                    <p><code>Pipeline</code> → <code>Step</code> → <code>Telemetry.onStepFailed()</code></p>
                    <p><strong>EVENT TYPES:</strong></p>
                    <p>- StepStarted: Before step execution begins</p>
                    <p>- StepSucceeded: After successful completion</p>
                    <p>- StepFailed: When step throws exception</p>
                </details>
            </div>
        </section>

        <section class="section">
            <h2>Implementation Examples</h2>

            <div class="card">
                <h3>Metrics Collection</h3>
                <pre><code class="language-php">// Collect performance metrics
final class MetricsTelemetry implements StepTelemetry {
    private array $timings = [];

    public function onStepStarted(StepStarted $event): void {
        $this->timings[$event->stepId] = microtime(true);
    }

    public function onStepSucceeded(StepSucceeded $event): void {
        $duration = microtime(true) - $this->timings[$event->stepId];
        Metrics::histogram('container.step.duration', $duration, [
            'step' => $event->stepName,
            'service' => $event->serviceId
        ]);
        Metrics::increment('container.step.success', [
            'step' => $event->stepName
        ]);
    }

    public function onStepFailed(StepFailed $event): void {
        Metrics::increment('container.step.failure', [
            'step' => $event->stepName,
            'error' => get_class($event->exception)
        ]);
    }
}</code></pre>
            </div>

            <div class="card">
                <h3>Logging and Debugging</h3>
                <pre><code class="language-php">// Log pipeline execution for debugging
final class LoggingTelemetry implements StepTelemetry {
    public function __construct(
        private Logger $logger
    ) {}

    public function onStepStarted(StepStarted $event): void {
        $this->logger->debug("Starting step: {$event->stepName}", [
            'service' => $event->serviceId,
            'depth' => $event->depth
        ]);
    }

    public function onStepSucceeded(StepSucceeded $event): void {
        $this->logger->debug("Step succeeded: {$event->stepName}", [
            'service' => $event->serviceId,
            'duration' => $event->duration
        ]);
    }

    public function onStepFailed(StepFailed $event): void {
        $this->logger->error("Step failed: {$event->stepName}", [
            'service' => $event->serviceId,
            'error' => $event->exception->getMessage(),
            'path' => $event->resolutionPath
        ]);
    }
}</code></pre>
            </div>

            <div class="card">
                <h3>Distributed Tracing</h3>
                <pre><code class="language-php">// Add tracing spans for observability
final class TracingTelemetry implements StepTelemetry {
    public function onStepStarted(StepStarted $event): void {
        $span = Tracer::startSpan("container.step.{$event->stepName}");
        $span->setAttribute('service.id', $event->serviceId);
        $span->setAttribute('resolution.depth', $event->depth);

        // Store span in context for later retrieval
        $event->context->setMeta('tracing', 'span', $span);
    }

    public function onStepSucceeded(StepSucceeded $event): void {
        $span = $event->context->getMeta('tracing', 'span');
        if ($span) {
            $span->setAttribute('duration', $event->duration);
            $span->end();
        }
    }

    public function onStepFailed(StepFailed $event): void {
        $span = $event->context->getMeta('tracing', 'span');
        if ($span) {
            $span->recordException($event->exception);
            $span->setStatus('ERROR', $event->exception->getMessage());
            $span->end();
        }
    }
}</code></pre>
            </div>

            <div class="card">
                <h3>Circuit Breaker Pattern</h3>
                <pre><code class="language-php">// Implement circuit breaker for failing steps
final class CircuitBreakerTelemetry implements StepTelemetry {
    private array $failureCounts = [];
    private array $lastFailureTime = [];
    private const THRESHOLD = 5;
    private const TIMEOUT = 60; // seconds

    public function onStepFailed(StepFailed $event): void {
        $step = $event->stepName;
        $this->failureCounts[$step] ??= 0;
        $this->failureCounts[$step]++;
        $this->lastFailureTime[$step] = time();

        if ($this->failureCounts[$step] >= self::THRESHOLD) {
            // Open circuit breaker
            $this->openCircuit($step);
        }
    }

    public function onStepSucceeded(StepSucceeded $event): void {
        $step = $event->stepName;
        // Reset on success
        $this->failureCounts[$step] = 0;
    }

    private function isCircuitOpen(string $step): bool {
        return isset($this->lastFailureTime[$step]) &&
               (time() - $this->lastFailureTime[$step]) < self::TIMEOUT &&
               ($this->failureCounts[$step] ?? 0) >= self::THRESHOLD;
    }
}</code></pre>
            </div>
        </section>

        <section class="section">
            <h2>Application Integration</h2>

            <div class="card">
                <h3>Multi-Telemetry Setup</h3>
                <pre><code class="language-php">// Combine multiple telemetry implementations
final class CompositeTelemetry implements StepTelemetry {
    private array $telemetries;

    public function __construct(StepTelemetry ...$telemetries) {
        $this->telemetries = $telemetries;
    }

    public function onStepStarted(StepStarted $event): void {
        foreach ($this->telemetries as $telemetry) {
            $telemetry->onStepStarted($event);
        }
    }

    public function onStepSucceeded(StepSucceeded $event): void {
        foreach ($this->telemetries as $telemetry) {
            $telemetry->onStepSucceeded($event);
        }
    }

    public function onStepFailed(StepFailed $event): void {
        foreach ($this->telemetries as $telemetry) {
            $telemetry->onStepFailed($event);
        }
    }
}

// Usage
$telemetry = new CompositeTelemetry(
    new MetricsTelemetry(),
    new LoggingTelemetry($logger),
    new TracingTelemetry()
);

$container->setTelemetry($telemetry);</code></pre>
            </div>

            <div class="card">
                <h3>Conditional Telemetry</h3>
                <pre><code class="language-php">// Enable telemetry only in certain environments
final class ConditionalTelemetry implements StepTelemetry {
    public function __construct(
        private StepTelemetry $delegate,
        private bool $enabled
    ) {}

    public function onStepStarted(StepStarted $event): void {
        if ($this->enabled) {
            $this->delegate->onStepStarted($event);
        }
    }

    public function onStepSucceeded(StepSucceeded $event): void {
        if ($this->enabled) {
            $this->delegate->onStepSucceeded($event);
        }
    }

    public function onStepFailed(StepFailed $event): void {
        // Always log failures, even if disabled
        $this->delegate->onStepFailed($event);
    }
}

// Usage
$telemetry = new ConditionalTelemetry(
    new MetricsTelemetry(),
    $_ENV['APP_ENV'] === 'production'
);</code></pre>
            </div>
        </section>

        <section class="section">
            <h2>Methods</h2>

            <div class="card" id="onStepStarted">
                <h3>onStepStarted</h3>
                <p>Handle step started event.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To perform setup before step execution</p>
                    <p>- To start timing or tracing operations</p>
                    <p>- To initialize telemetry collection</p>
                    <p><strong>EVENT DATA:</strong></p>
                    <p>The StepStarted event contains:</p>
                    <p>- stepId: Unique identifier for the step instance</p>
                    <p>- stepName: Human-readable step name</p>
                    <p>- serviceId: Service being resolved</p>
                    <p>- depth: Resolution depth for nested dependencies</p>
                    <p>- context: Full resolution context</p>
                    <p><strong>COMMON USES:</strong></p>
                    <p>- Start performance timers</p>
                    <p>- Create tracing spans</p>
                    <p>- Log step initiation</p>
                    <p>- Initialize step-specific state</p>
                </details>
            </div>

            <div class="card" id="onStepSucceeded">
                <h3>onStepSucceeded</h3>
                <p>Handle step succeeded event.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To collect success metrics and timing data</p>
                    <p>- To log successful step completion</p>
                    <p>- To finalize tracing spans</p>
                    <p><strong>EVENT DATA:</strong></p>
                    <p>The StepSucceeded event contains:</p>
                    <p>- stepId: Matches the started event</p>
                    <p>- stepName: Step identifier</p>
                    <p>- serviceId: Service being resolved</p>
                    <p>- duration: Execution time in seconds</p>
                    <p>- context: Resolution context with results</p>
                    <p><strong>SUCCESS METRICS:</strong></p>
                    <p>Track performance and success rates:</p>
                    <p>- Execution duration histograms</p>
                    <p>- Success counter increments</p>
                    <p>- Step-specific performance data</p>
                </details>
            </div>

            <div class="card" id="onStepFailed">
                <h3>onStepFailed</h3>
                <p>Handle step failed event.</p>
                <details class="more">
                    <summary>More</summary>
                    <p><strong>WHY IT EXISTS:</strong></p>
                    <p>- To collect error metrics and failure data</p>
                    <p>- To log detailed error information</p>
                    <p>- To implement circuit breaker patterns</p>
                    <p>- To support error alerting and monitoring</p>
                    <p><strong>EVENT DATA:</strong></p>
                    <p>The StepFailed event contains:</p>
                    <p>- stepId: The failed step instance</p>
                    <p>- stepName: Step that failed</p>
                    <p>- serviceId: Service being resolved</p>
                    <p>- exception: The thrown exception</p>
                    <p>- resolutionPath: Dependency chain</p>
                    <p>- context: Resolution context at failure</p>
                    <p><strong>ERROR HANDLING:</strong></p>
                    <p>Critical for observability:</p>
                    <p>- Log full error context and stack traces</p>
                    <p>- Increment failure counters and alerts</p>
                    <p>- Record error types and frequencies</p>
                    <p>- Preserve resolution path for debugging</p>
                </details>
            </div>
        </section>

        <section class="section">
            <h2>Performance Considerations</h2>
            <div class="card">
                <p><strong>Asynchronous Processing:</strong> Consider buffering events and processing them asynchronously to avoid blocking resolution.</p>
                <p><strong>Sampling:</strong> For high-throughput systems, implement sampling to reduce telemetry overhead.</p>
                <p><strong>Structured Logging:</strong> Use structured logging with consistent field names for better searchability.</p>
                <p><strong>Context Propagation:</strong> Ensure telemetry context flows through async operations and external calls.</p>
            </div>
        </section>
    </main>
</div>
</body>
</html>